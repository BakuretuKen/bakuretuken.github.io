(()=>{"use strict";function t(t){const n=t.split(" ");let o=[];for(const t of n){const n=t.split(",");o.push([n[0],n[1]])}return o}class n{constructor(){this.t=[[0,0,0,255],[0,0,255,255],[255,0,0,255],[255,0,255,255],[0,255,0,255],[0,255,255,255],[255,255,0,255],[255,255,255,255]],this.listeners=[]}static getInstance(){return n.instance||(n.instance=new n),n.instance}get colors(){return[...this.t]}setColor(t,n){t>=0&&t<this.t.length&&(this.t[t]=[...n],this.notifyListeners())}addChangeListener(t){this.listeners.push(t)}removeChangeListener(t){this.listeners=this.listeners.filter((n=>n!==t))}notifyListeners(){const t=this.colors;this.listeners.forEach((n=>n(t)))}}const o=n.getInstance();const c=t=>new Promise((n=>setTimeout(n,t)));async function s(){const n=document.getElementById("output"),s=document.getElementById("canvas");s.addEventListener("mousemove",(t=>{const o=s.getBoundingClientRect(),c=t.clientX-o.left,e=t.clientY-o.top;n.textContent=`マウス座標: (${Math.round(c)}, ${Math.round(e)})`})),s.addEventListener("click",(async t=>{const o=s.getBoundingClientRect(),c=`${Math.round(t.clientX-o.left)},${Math.round(t.clientY-o.top)}`;try{await navigator.clipboard.writeText("P "+c),n.textContent=`座標をコピーしました: ${c}`}catch(t){n.textContent="クリップボードへのコピーに失敗しました"}}));const e=await async function(t){try{const n=await fetch(t);return(await n.text()).split("\n").map((t=>t.trim()))}catch(t){}}(s.dataset.src||"data.txt");e&&(await async function(n,c){const s=n.getContext("2d");s.strokeStyle="black",s.lineWidth=1,c&&await async function(n){for(const c of n){const n=t(c);if(!(n.length<2)&&"P"!==n[0][0]&&"SET"!==n[0][0]){if(void 0===n[0][1]){const t=o.colors[Number(n[0][0])];s.strokeStyle=`rgba(${t[0]}, ${t[1]}, ${t[2]}, ${t[3]/255})`}else s.strokeStyle="black";s.beginPath(),s.moveTo(Number(n[0][0]),Number(n[0][1]));for(let t=1;t<n.length;t++)s.lineTo(Number(n[t][0]),Number(n[t][1])),s.stroke(),t%8==0&&await new Promise((t=>setTimeout(t,1)))}}}(c)}(s,e),await async function(n,s){const e=n.getContext("2d",{willReadFrequently:!0}),a=n.width,i=n.height;async function r(t,n,o,s,r){const h=e.getImageData(0,0,a,i),m=h.data,l=4*(n*a+t),w=[m[l],m[l+1],m[l+2],m[l+3]];if(u(w,o)||u(w,s))return;const b=[[t,n]];for(;b.length;){const[t,n]=b.shift();let u=t,l=t;for(;u>0&&f(m,u-1,n,w);)u--;for(;l<a-1&&f(m,l+1,n,w);)l++;for(let t=u;t<=l;t++){const c=Math.floor(t/2)%2==Math.floor(n/2)%2?o:s,e=4*(n*a+t);m[e]=c[0],m[e+1]=c[1],m[e+2]=c[2],m[e+3]=c[3]}e.putImageData(h,0,0),await c(r);for(const t of[n-1,n+1]){if(t<0||t>=i)continue;let n=!1,o=0;for(let c=u;c<=l+1;c++)c<=l&&f(m,c,t,w)?n||(n=!0,o=c):n&&(b.push([Math.floor((o+(c-1))/2),t]),n=!1)}}}function u(t,n){return!(!t||!n||t.length<4||n.length<4)&&t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]}function f(t,n,o,c){if(!c||c.length<4)return!1;const s=4*(o*a+n);return t[s]===c[0]&&t[s+1]===c[1]&&t[s+2]===c[2]&&t[s+3]===c[3]}e.imageSmoothingEnabled=!1,e.strokeStyle="black",e.lineWidth=1,s&&await async function(n){for(const c of n){const n=t(c);if("P"!==n[0][0])continue;const s=Number(n[1][0]),e=Number(n[1][1]),a=Number(n[2][0]),i=Number(n[3]?.[0]||a),u=o.colors[a]||[0,0,0,255],f=o.colors[i]||[0,0,0,255];await r(s,e,u,f,1)}}(s)}(s,e))}document.addEventListener("DOMContentLoaded",(async()=>{await s()}))})();