(()=>{"use strict";function t(t){const n=t.split(" ");let o=[];for(const t of n){const n=t.split(",");o.push([n[0],n[1]])}return o}class n{constructor(){this.t=[[0,0,0,255],[0,0,255,255],[255,0,0,255],[255,0,255,255],[0,255,0,255],[0,255,255,255],[255,255,0,255],[255,255,255,255]],this.listeners=[]}static getInstance(){return n.instance||(n.instance=new n),n.instance}get colors(){return[...this.t]}setColor(t,n){t>=0&&t<this.t.length&&(this.t[t]=[...n],this.notifyListeners())}addChangeListener(t){this.listeners.push(t)}removeChangeListener(t){this.listeners=this.listeners.filter((n=>n!==t))}notifyListeners(){const t=this.colors;this.listeners.forEach((n=>n(t)))}}const o=n.getInstance();const c=t=>new Promise((n=>setTimeout(n,t)));async function s(){const n=document.getElementById("output"),s=document.getElementById("canvas");s.addEventListener("mousemove",(t=>{const o=s.getBoundingClientRect(),c=t.clientX-o.left,a=t.clientY-o.top;n.textContent=`マウス座標: (${Math.round(c)}, ${Math.round(a)})`})),s.addEventListener("click",(async t=>{const o=s.getBoundingClientRect(),c=`${Math.round(t.clientX-o.left)},${Math.round(t.clientY-o.top)}`;try{await navigator.clipboard.writeText("P "+c),n.textContent=`座標をコピーしました: ${c}`}catch(t){n.textContent="クリップボードへのコピーに失敗しました"}}));const a=await async function(t){try{const n=await fetch(t);return(await n.text()).split("\n").map((t=>t.trim()))}catch(t){}}(s.dataset.src||"data.txt");a&&(await async function(n,o){const c=n.getContext("2d");c.strokeStyle="black",c.lineWidth=1,o&&await async function(n){for(const o of n){const n=t(o);if(!(n.length<2)&&"P"!==n[0][0]&&"SET"!==n[0][0]){c.beginPath(),c.moveTo(Number(n[0][0]),Number(n[0][1]));for(let t=1;t<n.length;t++)c.lineTo(Number(n[t][0]),Number(n[t][1])),c.stroke(),t%8==0&&await new Promise((t=>setTimeout(t,1)))}}}(o)}(s,a),await async function(n,s){const a=n.getContext("2d",{willReadFrequently:!0}),e=n.width,i=n.height;async function r(t,n,o,s,r){const h=a.getImageData(0,0,e,i),m=h.data,w=4*(n*e+t),l=[m[w],m[w+1],m[w+2],m[w+3]];if(u(l,o)||u(l,s))return;const y=[[t,n]];for(;y.length;){const[t,n]=y.shift();let u=t,w=t;for(;u>0&&f(m,u-1,n,l);)u--;for(;w<e-1&&f(m,w+1,n,l);)w++;for(let t=u;t<=w;t++){const c=Math.floor(t/2)%2==Math.floor(n/2)%2?o:s,a=4*(n*e+t);m[a]=c[0],m[a+1]=c[1],m[a+2]=c[2],m[a+3]=c[3]}a.putImageData(h,0,0),await c(r);for(const t of[n-1,n+1]){if(t<0||t>=i)continue;let n=!1,o=0;for(let c=u;c<=w+1;c++)c<=w&&f(m,c,t,l)?n||(n=!0,o=c):n&&(y.push([Math.floor((o+(c-1))/2),t]),n=!1)}}}function u(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]}function f(t,n,o,c){const s=4*(o*e+n);return t[s]===c[0]&&t[s+1]===c[1]&&t[s+2]===c[2]&&t[s+3]===c[3]}a.imageSmoothingEnabled=!1,a.strokeStyle="black",a.lineWidth=1,s&&await async function(n){for(const c of n){const n=t(c);if("P"!==n[0][0])continue;const s=Number(n[1][0]),a=Number(n[1][1]),e=Number(n[2][0]),i=Number(n[3]?.[0]||e);await r(s,a,o.colors[e],o.colors[i],1)}}(s)}(s,a))}document.addEventListener("DOMContentLoaded",(async()=>{await s()}))})();